

### 一、环境依赖 

- Java 8

- maven

- Python 3.8.8

- MongoDB 5.0.2

- npm
- yarn
- neo4j

### 二、项目结构

- script：python 项目
  - spider：爬虫相关
    - cve.py：CVE 爬虫
    - cve_detail.py：CVE 爬虫
    - exploit_spider.py：Exploit-DB 爬虫
    - github_spider.py：GitHub 爬虫
    - hardware_products.py：硬件产品爬虫
    - jvn_spider.py：JVN 爬虫
    - qly_spider.py：青莲云爬虫
    - spider_utils.py：爬虫工具集合
    - vuln_fusion.py：漏洞融合
  - utils：数据处理脚本
  - config.py：配置 MongoDB 的用户名密码
- backend2：后端
- frontend3：前端
- dashboard：数据大屏
- model：相关模型



### 三、MongoDB

> 新建以下集合（类比 MySQL 中的表）

| Collection | 注释              |
| ---------- | ----------------- |
| cve        | CVE               |
| data01     | Test              |
| device     | 设备信息          |
| exploit    | Exploit-DB（Poc） |
| github     | GitHub（Poc）     |
| iot        | IoT 漏洞          |
| iot2       | IoT 漏洞          |
| iot3       | IoT 漏洞          |
| jvndb      | JVNDB 漏洞        |
| jvndb2     | JVNDB 漏洞        |
| nvd        | NVD 漏洞          |
| nvd01      | NVD 漏洞          |
| submit_iot | 提交漏洞          |
| subscribe  | 漏洞订阅          |
| total      | 漏洞融合汇总      |
| user       | 用户信息          |



### 四、启动过程

##### 1.后端启动

```bash
$ mvn package
$ java -jar ***.jar
```



##### 2.前端启动

进入 frontend3 路径，两种方式启动：

yarn

```bash
$ yarn install
$ yarn serve
```
npm

```bash
$ npm install
$ npm run serve
```

##### 3.监控大屏

进入 dashboard 路径

```bash
$ yarn install
$ yarn run dev
```



### 五、爬虫模块

数据爬取

1. 先运行一次 **.py 获取全量的数据（漏洞、PoC）
2. 设置定时任务运行 **.py 获取增量数据
3. 设置定时任务运行 **.py 融合多源数据（cve + jvn） => 通知管理员
4. 管理员在系统核实后 => 邮件推送订阅者 



### 六、注意事项

##### 1.MongoDB 的配置需要修改:

backend2 中修改 /backend2/src/main/resources/application.yml

```yaml
server:
  port: 9090

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/leak?serverTimezone=UTC&characterEncoding=utf8&useUnicode=true&useSSL=false
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource
    initialSize: 3
    minidle: 3
    maxActive: 18
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 60000
    validationQuery: SELECT 1 FROM dual
    filters: stat,wall,log4j

#  security:
#    user:
#      name: admin
#      password: admin

  data:
    mongodb:
      # 此处需要修改
      uri: mongodb://zh:zhanghe@127.0.0.1:27017/vuln
    option:
      min-connection-per-host: 0
      max-connection-per-host: 100
      threads-allowed-to-block-for-connection-multiplier: 5
      server-selection-timeout: 30000
      max-wait-time: 120000
      max-connection-idle-time: 0
      max-connection-life-time: 0
      connect-timeout: 10000
      socket-timeout: 0
      socket-keep-alive: false
      ssl-enabled: false
      ssl-invalid-host-name-allowed: false
      always-use-m-beans: false
      heartbeat-socket-timeout: 20000
      heartbeat-connect-timeout: 20000
      min-heartbeat-frequency: 500
      heartbeat-frequency: 10000
      local-threshold: 15
    neo4j:
      database: tfsec

  neo4j:
    uri: bolt://localhost:7687
    authentication:
      username: neo4j
      password: test

mybatis:
  mapper-locations: classpath:mapper/*Mapper.xml


```



/script/config.py

```python
MONGO_HOST = '127.0.0.1'
# vuln
MONGO_USER = '****'
MONGO_PASSWORD = '****'
```

